<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Elm Frontend Tutorial &#8212; PLACE 0.8.0 documentation</title>
    <link rel="stylesheet" href="_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.8.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/sidebar.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Python Backend Tutorial" href="backend_tutorial.html" />
    <link rel="prev" title="PLACE configuration" href="config.html" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <link rel="shortcut icon" type="image/png" href="_static/favicon.png" />
    <meta name="viewport" content="width=device-width,initial-scale=0.8">
    
    

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="responsive-menu"><a href="#sidebar-anchor" title="Navigation">&#9776;</a></li>
        <li><a href="index.html">PLACE 0.8.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    
        <div class="badge">
            <a href="https://github.com/PALab/place/">Fork me on GitHub</a>
            <img src="_static/right-red@2x.png">
        </div>
    
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="elm-frontend-tutorial">
<h1>Elm Frontend Tutorial<a class="headerlink" href="#elm-frontend-tutorial" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Due to the sheer number of options available in PLACE, operating it via
the command-line interface, while possible, is cumbersome. In order to
provide users with easy access to all PLACE options, a web interface has
been developed. The web interface runs in JavaScript, making it well
supported across operating systems. However, to ease in the development
of JavaScript, the programming language <a class="reference external" href="https://elm-lang.org">Elm</a>
is highly recommended. Elm is a functional programming language with
static type checking that can be easily compiled to JavaScript.</p>
<div class="section" id="brief-elm-introduction">
<h3>Brief Elm introduction<a class="headerlink" href="#brief-elm-introduction" title="Permalink to this headline">¶</a></h3>
<p>Elm is probably new to most users of PLACE and, being a functional
language, it will appear different from many languages you have
encountered in the past. Rest assured, though, that our goal is not to
teach you to program in Elm, but rather to give you some simple tools
for constructing basic user interfaces using Elm.</p>
<p>As the term implies, functional languages treat everything as a
function. Look at a simple statement like:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span></span><span class="nf">x</span> <span class="ow">=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>This does not create a variable named <code class="docutils literal"><span class="pre">x</span></code> and give it the value <code class="docutils literal"><span class="pre">1</span></code>.
Instead, this creates a function named <code class="docutils literal"><span class="pre">x</span></code> that takes no inputs and
always produces <code class="docutils literal"><span class="pre">1</span></code>. Thus we cannot change the value of <code class="docutils literal"><span class="pre">x</span></code> to
something else. It is this differentiation that usually causes the most
confustion, but you will get used to it quickly.</p>
<p>When a function take arguments, they are simply listed after the
function name. Like this:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span></span><span class="nf">squareThis</span> <span class="n">number</span> <span class="ow">=</span> <span class="n">number</span> <span class="o">*</span> <span class="n">number</span>
</pre></div>
</div>
<p>In this example, <code class="docutils literal"><span class="pre">squareThis</span></code> is the function name, <code class="docutils literal"><span class="pre">number</span></code> is the
argument. In Python, this would essentially be the same code as this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">squareThis</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">number</span> <span class="o">*</span> <span class="n">number</span>
</pre></div>
</div>
<p>Okay, that’s a good start. The only other thing I want you to know right
now is that we often will explicitly list the types being used in a
function. So, you will often see our <code class="docutils literal"><span class="pre">squareThis</span></code> function written
like this:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span></span><span class="nf">squareThis</span> <span class="kt">:</span> <span class="kt">Float</span> <span class="ow">-&gt;</span> <span class="kt">Float</span>
<span class="nf">squareThis</span> <span class="n">number</span> <span class="ow">=</span> <span class="n">number</span> <span class="o">*</span> <span class="n">number</span>
</pre></div>
</div>
<p>The ‘type line’ just tells us that this function takes in one floating
point value and produces a new one. To compare, our simple <code class="docutils literal"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">1</span></code>
line would have a type line like <code class="docutils literal"><span class="pre">x</span> <span class="pre">:</span> <span class="pre">Int</span></code> to tell us that it took in
nothing and produced an integer.</p>
<p>My best advice at this point is just to move on. This won’t make
complete sense now, but you will usually have plenty of examples to use
so it doesn’t matter.</p>
</div>
<div class="section" id="making-html-with-elm">
<h3>Making HTML with Elm<a class="headerlink" href="#making-html-with-elm" title="Permalink to this headline">¶</a></h3>
<p>The main reason PLACE uses Elm is to produce solid JavaScript, which
will in turn produce HTML for the web interface. We will refer to the
HTML as the <em>view</em>, and it is what the user will see in their web
browser. Most of our Elm code will be used to build this.</p>
<p>In Elm, an HTML block has a special type, called <code class="docutils literal"><span class="pre">Html</span> <span class="pre">Msg</span></code>. As you
can see, this type has two words instead of just one. When you have a
type with multiple words, it is kind of like having all these types
stuck together. What this means to us is that all the HTML generated by
Elm will produce some HTML for the user (the <em>HTML</em>) to see and some
messages (the <em>Msg</em>) used to manipulate what is displayed on the web
page. For instance, when they see an HTML button, they can click it and
generate a <em>message</em>.</p>
<p>The <em>messages</em> generated by the user will update a <em>model</em> that sits
inside the code. In PLACE, this model is typically the values your
module is looking for in the JSON config data. But if you haven’t read
about that yet, don’t worry.</p>
<p>All the above concepts come together into an <code class="docutils literal"><span class="pre">Html.program</span></code>, which is
just a way to wrap up all the things Elm needs into a nice little
package.</p>
<p>If you feel like you need to learn more about Elm, you can go through
<a class="reference external" href="https://guide.elm-lang.org/">their tutorial</a>. Otherwise, I’m going
to start talking about making a web interface for a PLACE module.</p>
</div>
<div class="section" id="template-module">
<h3>Template module<a class="headerlink" href="#template-module" title="Permalink to this headline">¶</a></h3>
<p>A lot of the Elm code will start the same way, so we have included a
template to use when starting a new module. You can find it
<a class="reference external" href="https://github.com/PALab/place/blob/master/elm/plugins/PLACETemplate.elm">here</a>.</p>
<p>Let’s quickly run through this file.</p>
<p>The first line defines the module. Specifying <em>port</em> at the beginning
allows our interface to communicate with PLACE.</p>
<div class="highlight-haskell"><div class="highlight"><pre><span></span><span class="nf">port</span> <span class="kr">module</span> <span class="nn">PLACETemplate</span> <span class="n">exposing</span> <span class="p">(</span><span class="n">main</span><span class="p">)</span>
</pre></div>
</div>
<p>This is followed by standard imports, which use a similar syntax to
Python.</p>
<div class="highlight-haskell"><div class="highlight"><pre><span></span><span class="kr">import</span> <span class="nn">Html</span> <span class="n">exposing</span> <span class="p">(</span><span class="kt">Html</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Html.Events</span>
<span class="kr">import</span> <span class="nn">Html.Attributes</span>
<span class="kr">import</span> <span class="nn">Json.Encode</span>
<span class="kr">import</span> <span class="nn">ModuleHelpers</span>
</pre></div>
</div>
<p>The last import, <code class="docutils literal"><span class="pre">ModuleHelpers</span></code>, is a PLACE library of helpful
functions. These are used to simplify the process of writing new modules
for PLACE.</p>
<p>At this point, we start getting into the actual code. Generally, it
makes sense to start with the <em>model</em> first. The model is the data
structure that contains variable values needed to run your device on
PLACE. The template includes the values needed by all PLACE modules,
but you can (and should) add values to this list as needed by your
module.</p>
<div class="highlight-haskell"><div class="highlight"><pre><span></span><span class="kr">type</span> <span class="n">alias</span> <span class="kt">Model</span> <span class="ow">=</span>
    <span class="p">{</span> <span class="n">moduleName</span> <span class="kt">:</span> <span class="kt">String</span>
    <span class="p">,</span> <span class="n">className</span> <span class="kt">:</span> <span class="kt">String</span>
    <span class="p">,</span> <span class="n">active</span> <span class="kt">:</span> <span class="kt">Bool</span>
    <span class="p">,</span> <span class="n">priority</span> <span class="kt">:</span> <span class="kt">Int</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>Now that we have a model, we need to have a way to work with the model.
Elm uses messages to do this. Each message defines an action you would
like to perform with the data model. The default messages are provided
in the template, but you will need to add additional messages to modify
the values added to the data model in the previous step.</p>
<div class="highlight-haskell"><div class="highlight"><pre><span></span><span class="kr">type</span> <span class="kt">Msg</span>
    <span class="ow">=</span> <span class="kt">ToggleActive</span>
    <span class="o">|</span> <span class="kt">ChangePriority</span> <span class="kt">String</span>
    <span class="o">|</span> <span class="kt">SendJson</span>
    <span class="o">|</span> <span class="kt">Close</span>
</pre></div>
</div>
<p>Each message is essentially a function and can take additional
arguments. <code class="docutils literal"><span class="pre">ToggleActive</span></code> doesn’t take any arguments because it just
flips a boolean value back and forth. <code class="docutils literal"><span class="pre">ChangePriority</span></code> takes a
<code class="docutils literal"><span class="pre">String</span></code> as an argument because the value will be typed by the user
into the web interface.</p>
<p>Okay, after the data model and functions to modify the model, we wil
start seeing how all of this fits together. The next line is a simple
one.</p>
<div class="highlight-haskell"><div class="highlight"><pre><span></span><span class="nf">port</span> <span class="n">jsonData</span> <span class="kt">:</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span><span class="o">.</span><span class="kt">Value</span> <span class="ow">-&gt;</span> <span class="kt">Cmd</span> <span class="n">msg</span>
</pre></div>
</div>
<p>This line defines a function that sends data over a port. All PLACE
interfaces need to be able to send their data (in JSON format) to PLACE
so that PLACE can provide it to the instrument during the experiment.
This is where that happens and it will always look just like this - no
need to change it.</p>
<p>From this point, it will start getting a bit more complicated, but don’t
worry too much if it doesn’t all make sense at first.</p>
<p>The <em>main</em> function is the heart of the Elm interface. This is what
creates all the JavaScript code to run the interface. Fortunately, the
<code class="docutils literal"><span class="pre">Html</span></code> module we imported at the beginning does all this for us. We
just need to specify four different arguments. Here is the code:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span></span><span class="nf">main</span> <span class="kt">:</span> <span class="kt">Program</span> <span class="kt">Never</span> <span class="kt">Model</span> <span class="kt">Msg</span>
<span class="nf">main</span> <span class="ow">=</span>
    <span class="kt">Html</span><span class="o">.</span><span class="n">program</span>
        <span class="p">{</span> <span class="n">init</span> <span class="ow">=</span> <span class="p">(</span> <span class="n">defaultModel</span><span class="p">,</span> <span class="kt">Cmd</span><span class="o">.</span><span class="n">none</span> <span class="p">)</span>
        <span class="p">,</span> <span class="n">view</span> <span class="ow">=</span> <span class="nf">\</span><span class="n">model</span> <span class="ow">-&gt;</span> <span class="kt">Html</span><span class="o">.</span><span class="n">div</span> <span class="kt">[]</span> <span class="p">(</span><span class="n">viewModel</span> <span class="n">model</span><span class="p">)</span>
        <span class="p">,</span> <span class="n">update</span> <span class="ow">=</span> <span class="n">updateModel</span>
        <span class="p">,</span> <span class="n">subscriptions</span> <span class="ow">=</span> <span class="nf">\</span><span class="kr">_</span> <span class="ow">-&gt;</span> <span class="kt">Sub</span><span class="o">.</span><span class="n">none</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>So, the four things needed by the <code class="docutils literal"><span class="pre">Html.program</span></code> function are: <em>init</em>,
<em>view</em>, <em>update</em>, and <em>subscriptions</em>.</p>
<p>The first argument, <em>init</em>, just tells the program the initial value of
all the variables in the data model, plus the first command to run
(usually just <code class="docutils literal"><span class="pre">Cmd.none</span></code>). For now, we just tell <em>init</em> that the
initial values will be provided by a function named <em>defaultModel</em> that
we will write later.</p>
<p>The second argument is <em>view</em>. This needs to be set to a function that
tells Elm how to display the current data model to the user. This is
probably where most of our work needs to be done, because we will need
to determine how to generate all the HTML used to display the current
values of all the configuration settings to the user, but we also need
the view to give them options for changing the current values to other
values. If you’ve looked at any of the other modules in the PLACE web
interface, you will see that this is usually done by displaying a number
of checkboxes, dropdown menus, and text boxes. The current setting will
display in each box and the user will be able to change them as desired.</p>
<p>After the view is the <em>update</em> argument. This is where the changes made
on the web interface are processed to update the data model.
Essentailly, all the interactive components on the web interface will
produce a message when the user changes a value. This message is then
sent to the update function and changes something in the data model.
Once the update is done, the <em>view</em> will but changed to reflect the
update. This probably sounds pretty complicated, but we don’t really
need to think about how this all happens. We just need to know that it
<em>does</em> happen.</p>
<p>The final value is the <em>subscription</em>, which is not currently used by
PLACE. Just leave it the way it is. We will not cover it in this guide.
In fact, nothing in this entire function needs to be changed. The parts
you will change have been delegated to other functions.</p>
<p>Now let’s look at the definitions for <em>defaultModel</em>, <em>viewModel</em>, and
<em>updateModel</em>, which are the implementations of <em>init</em>, <em>view</em>, and
<em>update</em>.</p>
<p>Here is the <em>defaultModel</em>:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span></span><span class="nf">defaultModel</span> <span class="kt">:</span> <span class="kt">Model</span>
<span class="nf">defaultModel</span> <span class="ow">=</span>
    <span class="p">{</span> <span class="n">moduleName</span> <span class="ow">=</span> <span class="s">&quot;place_template&quot;</span>
    <span class="p">,</span> <span class="n">className</span> <span class="ow">=</span> <span class="s">&quot;None&quot;</span>
    <span class="p">,</span> <span class="n">active</span> <span class="ow">=</span> <span class="kt">False</span>
    <span class="p">,</span> <span class="n">priority</span> <span class="ow">=</span> <span class="mi">10</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>This should look familiar. It is basically the <em>Model</em> from the top of
the code, but with default values filled in. Here you will want to set
the <code class="docutils literal"><span class="pre">moduleName</span></code> to match the name of the Python module that
accompanies your web interface. You will also want to select a default
priority. Currently, instruments usually have a priority in the 0-100
range, and post-processing modules hover around 1000 (so they can
<em>post</em>-process) - but PLACE does not enforce this value in any way.</p>
<p>Now let’s look at the <em>viewModel</em>:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span></span><span class="nf">viewModel</span> <span class="kt">:</span> <span class="kt">Model</span> <span class="ow">-&gt;</span> <span class="kt">List</span> <span class="p">(</span><span class="kt">Html</span> <span class="kt">Msg</span><span class="p">)</span>
<span class="nf">viewModel</span> <span class="n">model</span> <span class="ow">=</span>
    <span class="kt">ModuleHelpers</span><span class="o">.</span><span class="n">title</span> <span class="s">&quot;PLACETemplate&quot;</span> <span class="n">model</span><span class="o">.</span><span class="n">active</span> <span class="kt">ToggleActive</span> <span class="kt">Close</span>
        <span class="o">++</span> <span class="kr">if</span> <span class="n">model</span><span class="o">.</span><span class="n">active</span> <span class="kr">then</span>
            <span class="p">[</span> <span class="kt">ModuleHelpers</span><span class="o">.</span><span class="n">integerField</span> <span class="s">&quot;Priority&quot;</span> <span class="n">model</span><span class="o">.</span><span class="n">priority</span> <span class="kt">ChangePriority</span> <span class="p">]</span>
           <span class="kr">else</span>
            <span class="p">[</span> <span class="kt">ModuleHelpers</span><span class="o">.</span><span class="n">empty</span> <span class="p">]</span>
</pre></div>
</div>
<p>This is where all our HTML code is produced. Because HTML can be
complicated, a lot of work has been done recently to streamline this
process. The <code class="docutils literal"><span class="pre">ModuleHelpers</span></code> module contains lots of helper functions
for writing the HTML parts, as we will see.</p>
<p>We can see from the function definition the this function is provided
with the current data model, named <em>model</em>, and produces a list of
<code class="docutils literal"><span class="pre">Html</span> <span class="pre">Msg</span></code> (essentially meaning it produces both HTML and messages).</p>
<p>Most modules will be able to use the <code class="docutils literal"><span class="pre">ModuleHelpers.title</span></code> function to
begin the <code class="docutils literal"><span class="pre">viewModel</span></code> function. <code class="docutils literal"><span class="pre">title</span></code> takes three arguments; the
name of your web interface, the variable used to determine if the module
is <em>active</em> or not, and the message used to activate/deactivate your
module. If you kept the <code class="docutils literal"><span class="pre">active</span></code> variable in your model the same, we
have shown here, you can leave this line the same - just change the name
of the interface.</p>
<p>After the title, we use the <code class="docutils literal"><span class="pre">++</span></code> operation to <em>append</em> some more stuff
to the <code class="docutils literal"><span class="pre">List</span> <span class="pre">(Html</span> <span class="pre">Msg)</span></code> we are building. But we only want to append
this stuff if the module is active, so we use an <code class="docutils literal"><span class="pre">if</span></code> statement. In
Elm, <code class="docutils literal"><span class="pre">if</span></code> statements use an <code class="docutils literal"><span class="pre">if</span></code>/<code class="docutils literal"><span class="pre">then</span></code>/<code class="docutils literal"><span class="pre">else</span></code> syntax. In the
<code class="docutils literal"><span class="pre">else</span></code> part, we see that if the model is not active, we will just
append an empty list (technically it appends an empty text string). If
the model <em>is</em> active, however, we will display an integer field, where
the user can enter an integer value. This field will be labelled
“Priority” on the web interface, it will be associated with the
<code class="docutils literal"><span class="pre">model.priority</span></code> value, and <code class="docutils literal"><span class="pre">ChangePriority</span></code> is the message used to
change the value. By passing these three things to
<code class="docutils literal"><span class="pre">ModuleHelpers.integerField</span></code>, the function will be able to construct
the rest of the HTML needed to display the field in the web interface.</p>
<p>These helper functions are new (as of writing this), but we already have
helpers for checkboxes, integers, floats, and strings. By the time you
read this, there should be one written for dropdown menus, too. Check
the <code class="docutils literal"><span class="pre">ModuleHelpers.elm</span></code> in the <code class="docutils literal"><span class="pre">place/elm/plugins/</span></code> directory for
the latest offering.</p>
<p>The last piece of the puzzle is the <em>updateModel</em> function.</p>
<div class="highlight-haskell"><div class="highlight"><pre><span></span><span class="nf">updateModel</span> <span class="kt">:</span> <span class="kt">Msg</span> <span class="ow">-&gt;</span> <span class="kt">Model</span> <span class="ow">-&gt;</span> <span class="p">(</span> <span class="kt">Model</span><span class="p">,</span> <span class="kt">Cmd</span> <span class="kt">Msg</span> <span class="p">)</span>
<span class="nf">updateModel</span> <span class="n">msg</span> <span class="n">model</span> <span class="ow">=</span>
    <span class="kr">case</span> <span class="n">msg</span> <span class="kr">of</span>
        <span class="kt">ToggleActive</span> <span class="ow">-&gt;</span>
            <span class="kr">if</span> <span class="n">model</span><span class="o">.</span><span class="n">active</span> <span class="kr">then</span>
                <span class="n">updateModel</span> <span class="kt">SendJson</span>
                    <span class="p">{</span> <span class="n">model</span>
                        <span class="o">|</span> <span class="n">className</span> <span class="ow">=</span> <span class="s">&quot;None&quot;</span>
                        <span class="p">,</span> <span class="n">active</span> <span class="ow">=</span> <span class="kt">False</span>
                    <span class="p">}</span>
            <span class="kr">else</span>
                <span class="n">updateModel</span> <span class="kt">SendJson</span>
                    <span class="p">{</span> <span class="n">model</span>
                        <span class="o">|</span> <span class="n">className</span> <span class="ow">=</span> <span class="s">&quot;PLACETemplate&quot;</span>
                        <span class="p">,</span> <span class="n">active</span> <span class="ow">=</span> <span class="kt">True</span>
                    <span class="p">}</span>

        <span class="kt">ChangePriority</span> <span class="n">newPriority</span> <span class="ow">-&gt;</span>
            <span class="n">updateModel</span> <span class="kt">SendJson</span>
                <span class="p">{</span> <span class="n">model</span>
                    <span class="o">|</span> <span class="n">priority</span> <span class="ow">=</span> <span class="kt">Result</span><span class="o">.</span><span class="n">withDefault</span> <span class="mi">10</span> <span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="n">toInt</span> <span class="n">newPriority</span><span class="p">)</span>
                <span class="p">}</span>

        <span class="kt">SendJson</span> <span class="ow">-&gt;</span>
            <span class="p">(</span> <span class="n">model</span>
            <span class="p">,</span> <span class="n">jsonData</span>
                <span class="p">(</span><span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span><span class="o">.</span><span class="n">list</span>
                    <span class="p">[</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span><span class="o">.</span><span class="n">object</span>
                        <span class="p">[</span> <span class="p">(</span> <span class="s">&quot;module_name&quot;</span><span class="p">,</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span><span class="o">.</span><span class="n">string</span> <span class="n">model</span><span class="o">.</span><span class="n">moduleName</span> <span class="p">)</span>
                        <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;class_name&quot;</span><span class="p">,</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span><span class="o">.</span><span class="n">string</span> <span class="n">model</span><span class="o">.</span><span class="n">className</span> <span class="p">)</span>
                        <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;priority&quot;</span><span class="p">,</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span><span class="o">.</span><span class="n">int</span> <span class="n">model</span><span class="o">.</span><span class="n">priority</span> <span class="p">)</span>
                        <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;config&quot;</span>
                          <span class="p">,</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span><span class="o">.</span><span class="n">object</span>
                                <span class="kt">[]</span>
                          <span class="p">)</span>
                        <span class="p">]</span>
                    <span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="kt">Close</span> <span class="ow">-&gt;</span>
            <span class="kr">let</span>
                <span class="p">(</span> <span class="n">clearModel</span><span class="p">,</span> <span class="n">clearModelCmd</span> <span class="p">)</span> <span class="ow">=</span>
                    <span class="n">updateModel</span> <span class="kt">SendJson</span> <span class="o">&lt;|</span> <span class="n">defaultModel</span>
            <span class="kr">in</span>
                <span class="n">clearModel</span> <span class="o">!</span> <span class="p">[</span> <span class="n">clearModelCmd</span><span class="p">,</span> <span class="n">removeModule</span> <span class="n">pythonModuleName</span> <span class="p">]</span>
</pre></div>
</div>
<p>In this function, we just have to write the code for each of our
messages. So we start with a <code class="docutils literal"><span class="pre">case</span></code> statement and then list each
message. Let’s take a moment and explain what’s happening in the three
messages provided by this template.</p>
<p><code class="docutils literal"><span class="pre">ToggleActive</span></code> is the first one. If <code class="docutils literal"><span class="pre">ToggleActive</span></code> corresponded to a
normal boolean value, we could simply have written:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span></span><span class="kt">ToggleSomething</span> <span class="ow">-&gt;</span> <span class="n">updateModel</span> <span class="kt">SendJson</span> <span class="p">{</span> <span class="n">model</span> <span class="o">|</span> <span class="n">something</span> <span class="ow">=</span> <span class="n">not</span> <span class="n">model</span><span class="o">.</span><span class="n">something</span> <span class="p">}</span>
</pre></div>
</div>
<p>This can be read as:</p>
<blockquote>
<div>“Update the model and send JSON data for the current model such that
something is now not something.”</div></blockquote>
<p>You can use this format for most boolean configuration values, but
<code class="docutils literal"><span class="pre">ToggleActive</span></code> is a bit different. When we set <code class="docutils literal"><span class="pre">model.active</span></code> to
<code class="docutils literal"><span class="pre">False</span></code> we also need to set <code class="docutils literal"><span class="pre">className</span></code> to <code class="docutils literal"><span class="pre">None</span></code>. PLACE enforces
this convention. So, when you are writing your own module, you can take
the <code class="docutils literal"><span class="pre">ToggleActive</span></code> code directly from this file, just change the
<code class="docutils literal"><span class="pre">className</span></code> to match the one in the Python module. If you have more
than one class in your module, you will need to take a more advanced
approach that is not covered here.</p>
<p>The <code class="docutils literal"><span class="pre">SendJson</span></code> message is a special one, because it handles syncing up
the data with PLACE. The entire data model is encoded into JSON and the
JSON is sent over a port to PLACE. We will talk about this more later.</p>
<p>So that’s it! From here, we will explore adapting this interface for
your own devices.</p>
</div>
</div>
<div class="section" id="starting-your-own-module">
<h2>Starting your own module<a class="headerlink" href="#starting-your-own-module" title="Permalink to this headline">¶</a></h2>
<p>In this section, I will attempt to demonstrate how easy it is to create the web
interface for a PLACE module.  Essentially, the frontend is just a user
interface that allows access to all the options for your module.  If you’ve
done a good job planning your module, this is usually pretty simple.</p>
<p>In this example, I will be explaining the development of the frontend for the
SRS SR560 PreAmp.</p>
<div class="section" id="create-the-elm-file">
<h3>Create the Elm file<a class="headerlink" href="#create-the-elm-file" title="Permalink to this headline">¶</a></h3>
<p>You new frontend file will need to be put into the <code class="docutils literal"><span class="pre">place/elm/plugins/</span></code>
directory. Elm files typically use capitalized words (<a class="reference external" href="https://en.wikipedia.org/wiki/Camel_case">CamelCase</a>) and will match the name of the
module contained in the file.  This example is at
<code class="docutils literal"><span class="pre">place/elm/plugins/SR560PreAmp.elm</span></code>.</p>
<p>The file will almost always start the same way for PLACE modules.</p>
<div class="highlight-haskell"><div class="highlight"><pre><span></span><span class="nf">port</span> <span class="kr">module</span> <span class="nn">SR560PreAmp</span> <span class="n">exposing</span> <span class="p">(</span><span class="n">main</span><span class="p">)</span>

<span class="kr">import</span> <span class="nn">Html</span> <span class="n">exposing</span> <span class="p">(</span><span class="kt">Html</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Html.Events</span>
<span class="kr">import</span> <span class="nn">Html.Attributes</span>
<span class="kr">import</span> <span class="nn">Json.Encode</span>
<span class="kr">import</span> <span class="nn">ModuleHelpers</span>
</pre></div>
</div>
<p>This code just formalizes the name of our module in Elm and imports stuff we
will need later.</p>
</div>
<div class="section" id="match-the-frontend-with-the-backend">
<h3>Match the frontend with the backend<a class="headerlink" href="#match-the-frontend-with-the-backend" title="Permalink to this headline">¶</a></h3>
<p>All PLACE modules consist of an Elm frontend and a Python backend. PLACE
controls all the communication between the two, so we need to make sure PLACE
knows which Python module belongs to our Elm module.</p>
<div class="highlight-haskell"><div class="highlight"><pre><span></span><span class="nf">pythonModuleName</span> <span class="ow">=</span>
    <span class="s">&quot;sr560_preamp&quot;</span>

<span class="nf">pythonClassName</span> <span class="ow">=</span>
    <span class="s">&quot;SR560PreAmp&quot;</span>
</pre></div>
</div>
<p>Conventionally, Python modules use lowercase letters and underscores, and
Python classes use capitalized words
(<a class="reference external" href="https://www.python.org/dev/peps/pep-0008/#naming-conventions">PEP 8</a>).
It’s usually best to just make the Python class and the Elm module the same
string and then use a lowercase version for the Python module.</p>
</div>
<div class="section" id="module-model">
<h3>Module model<a class="headerlink" href="#module-model" title="Permalink to this headline">¶</a></h3>
<p>Now we need to figure out the module model, which is basically a list of all
the variables the user will need to interact with and change. For the SR560, we
need the user to be able to select: amplifier blanking, input coupling, dynamic
reserve, filter mode, gain, highpass filter frequency, lowpass filter
frequency, signal invert sense, input source, Vernier gain status, and Vernier
gain values. This seems like a lot, but it’s actually not too bad.</p>
<p>For each of these values, we need to assign a name in the model and also the
type used to represent them. Most of the time, the type will be String, but we
can also use the typical Int, Float, Bool, or really anything that can be
encoded into JSON.</p>
<p>Here is our model:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span></span><span class="kr">type</span> <span class="n">alias</span> <span class="kt">Model</span> <span class="ow">=</span>
    <span class="p">{</span> <span class="n">className</span> <span class="kt">:</span> <span class="kt">String</span>
    <span class="p">,</span> <span class="n">active</span> <span class="kt">:</span> <span class="kt">Bool</span>
    <span class="p">,</span> <span class="n">priority</span> <span class="kt">:</span> <span class="kt">Int</span>
    <span class="p">,</span> <span class="n">blanking</span> <span class="kt">:</span> <span class="kt">String</span>
    <span class="p">,</span> <span class="n">coupling</span> <span class="kt">:</span> <span class="kt">String</span>
    <span class="p">,</span> <span class="n">reserve</span> <span class="kt">:</span> <span class="kt">String</span>
    <span class="p">,</span> <span class="n">mode</span> <span class="kt">:</span> <span class="kt">String</span>
    <span class="p">,</span> <span class="n">gain</span> <span class="kt">:</span> <span class="kt">String</span>
    <span class="p">,</span> <span class="n">highpass</span> <span class="kt">:</span> <span class="kt">String</span>
    <span class="p">,</span> <span class="n">lowpass</span> <span class="kt">:</span> <span class="kt">String</span>
    <span class="p">,</span> <span class="n">invert</span> <span class="kt">:</span> <span class="kt">String</span>
    <span class="p">,</span> <span class="n">source</span> <span class="kt">:</span> <span class="kt">String</span>
    <span class="p">,</span> <span class="n">vGainStat</span> <span class="kt">:</span> <span class="kt">String</span>
    <span class="p">,</span> <span class="n">vGain</span> <span class="kt">:</span> <span class="kt">Int</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>The first three values in our model are standard PLACE values and we included
them from the template. The other values match the ones needing to be set by
the user. Note that all of them will be set as Strings except the last one.
Strings are great to use when there is a limited number of options, and they
can be displayed in a dropdown menu. The <code class="docutils literal"><span class="pre">vGain</span></code> value simply has too large a
range to use a dropdown menu, so we will just have the user type in an integer
value.</p>
<p>Next, we will define an instance of Model that represents the default state of
the module. This is what the values will be set to when the webapp is loaded.</p>
<div class="highlight-haskell"><div class="highlight"><pre><span></span><span class="nf">defaultModel</span> <span class="kt">:</span> <span class="kt">Model</span>
<span class="nf">defaultModel</span> <span class="ow">=</span>
    <span class="p">{</span> <span class="n">className</span> <span class="ow">=</span> <span class="s">&quot;None&quot;</span>
    <span class="p">,</span> <span class="n">active</span> <span class="ow">=</span> <span class="kt">False</span>
    <span class="p">,</span> <span class="n">priority</span> <span class="ow">=</span> <span class="mi">10</span>
    <span class="p">,</span> <span class="n">blanking</span> <span class="ow">=</span> <span class="s">&quot;not blanked&quot;</span>
    <span class="p">,</span> <span class="n">coupling</span> <span class="ow">=</span> <span class="s">&quot;DC&quot;</span>
    <span class="p">,</span> <span class="n">reserve</span> <span class="ow">=</span> <span class="s">&quot;calibration gains&quot;</span>
    <span class="p">,</span> <span class="n">mode</span> <span class="ow">=</span> <span class="s">&quot;bypass&quot;</span>
    <span class="p">,</span> <span class="n">gain</span> <span class="ow">=</span> <span class="s">&quot;1&quot;</span>
    <span class="p">,</span> <span class="n">highpass</span> <span class="ow">=</span> <span class="s">&quot;0.03 Hz&quot;</span>
    <span class="p">,</span> <span class="n">lowpass</span> <span class="ow">=</span> <span class="s">&quot;1 MHz&quot;</span>
    <span class="p">,</span> <span class="n">invert</span> <span class="ow">=</span> <span class="s">&quot;non-inverted&quot;</span>
    <span class="p">,</span> <span class="n">source</span> <span class="ow">=</span> <span class="s">&quot;A&quot;</span>
    <span class="p">,</span> <span class="n">vGainStat</span> <span class="ow">=</span> <span class="s">&quot;calibrated gain&quot;</span>
    <span class="p">,</span> <span class="n">vGain</span> <span class="ow">=</span> <span class="mi">20</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>It is standard PLACE practice to set the default <code class="docutils literal"><span class="pre">className</span></code> to <code class="docutils literal"><span class="pre">&quot;None&quot;</span></code>
and <code class="docutils literal"><span class="pre">active</span></code> to <code class="docutils literal"><span class="pre">False</span></code>. The user should always need to <em>activate</em> your
instrument in PLACE.  The value for <a class="reference internal" href="glossary.html#term-priority"><span class="xref std std-term">priority</span></a> is required, but you can
change the value to anything you want.</p>
<p>The rest of the values are independent of PLACE and we can set them as we like.
If you don’t know the values you want here at this stage, you can always write
the rest and then come back and fill these in later.</p>
</div>
<div class="section" id="define-messages">
<h3>Define messages<a class="headerlink" href="#define-messages" title="Permalink to this headline">¶</a></h3>
<p>The next step is to define the messages. A <a class="reference internal" href="glossary.html#term-message"><span class="xref std std-term">message</span></a> is used to make user
updates to the model. Generally, you need one message for each value that needs
to be changed.</p>
<div class="highlight-haskell"><div class="highlight"><pre><span></span><span class="kr">type</span> <span class="kt">Msg</span>
    <span class="ow">=</span> <span class="kt">ToggleActive</span>
    <span class="o">|</span> <span class="kt">ChangePriority</span> <span class="kt">String</span>
    <span class="o">|</span> <span class="kt">SendJson</span>
    <span class="o">|</span> <span class="kt">Close</span>
    <span class="o">|</span> <span class="kt">ChangeBlanking</span> <span class="kt">String</span>
    <span class="o">|</span> <span class="kt">ChangeCoupling</span> <span class="kt">String</span>
    <span class="o">|</span> <span class="kt">ChangeReserve</span> <span class="kt">String</span>
    <span class="o">|</span> <span class="kt">ChangeFilterMode</span> <span class="kt">String</span>
    <span class="o">|</span> <span class="kt">ChangeGain</span> <span class="kt">String</span>
    <span class="o">|</span> <span class="kt">ChangeHighpassFilter</span> <span class="kt">String</span>
    <span class="o">|</span> <span class="kt">ChangeLowpassFilter</span> <span class="kt">String</span>
    <span class="o">|</span> <span class="kt">ChangeSignalInvertSense</span> <span class="kt">String</span>
    <span class="o">|</span> <span class="kt">ChangeInputSource</span> <span class="kt">String</span>
    <span class="o">|</span> <span class="kt">ChangeVernierGainStatus</span> <span class="kt">String</span>
    <span class="o">|</span> <span class="kt">ChangeVernierGain</span> <span class="kt">String</span>
</pre></div>
</div>
<p>The first four messages are from the template, so we don’t need to worry about
these right now. The rest of the messages are associated with the values we put
into our model. Each one is linked to a String, which will be the user input.
What this means is that when the user changes a value on the web interface, we
will get a message telling us which value they changed, and a String telling us
the new value they are requesting.</p>
<p>You may have noticed that we have made <code class="docutils literal"><span class="pre">vGain</span></code> an <code class="docutils literal"><span class="pre">Int</span></code> value, but our user
input message, <code class="docutils literal"><span class="pre">ChangeVernierGain</span></code>, gets the user input in a string format.
In this case, it will be up to our Elm code to convert the String to an Int,
meaning that this message will be <em>slightly</em> more complicated to process.</p>
</div>
<div class="section" id="ports">
<h3>Ports<a class="headerlink" href="#ports" title="Permalink to this headline">¶</a></h3>
<p>Elm is a helper language, designed to ease the process of writing JavaScript.
It can’t do everything. For instance, Elm cannot communicate with other Elm
modules. To get around this, Elm uses <em>ports</em> to communicate with the
JavaScript that is running it.</p>
<p>PLACE uses ports to send information between all the modules. This happens
behind the scenes, but it very important. What this means for us is that our
module needs to open a port with a specific name and PLACE will then listen to
it and wait for information.</p>
<div class="highlight-haskell"><div class="highlight"><pre><span></span><span class="nf">port</span> <span class="n">jsonData</span> <span class="kt">:</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span><span class="o">.</span><span class="kt">Value</span> <span class="ow">-&gt;</span> <span class="kt">Cmd</span> <span class="n">msg</span>
</pre></div>
</div>
<p>That’s all it takes to set up a port in Elm. The name of the port is
<code class="docutils literal"><span class="pre">jsonData</span></code> and if we pass it an encoded JSON value, it will create a
<a class="reference internal" href="glossary.html#term-command"><span class="xref std std-term">command</span></a>, meaning it will send the data out for us. If we ever want to
send JSON data to PLACE, we just call this port and it will be done.</p>
<p>We also have another port, but this one will be linked to the browser. Our
webapp will have a <em>close</em> button. If the user presses this, it means they
don’t want to see our webapp anymore, so we will use this port to tell the
browser not to load this webapp in the future.</p>
<div class="highlight-haskell"><div class="highlight"><pre><span></span><span class="nf">port</span> <span class="n">removeModule</span> <span class="kt">:</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">Cmd</span> <span class="n">msg</span>
</pre></div>
</div>
<p>PLACE modules need both of these ports.</p>
</div>
<div class="section" id="updating-the-model">
<h3>Updating the model<a class="headerlink" href="#updating-the-model" title="Permalink to this headline">¶</a></h3>
<p>Now that we have the code for the model, we’ve created the messages, and
defined the ports. The next step is to write the code that updates the model in
response to a message. This is usually pretty simple unless you are doing
something complex, so look at other PLACE modules to get some examples if you
are stuck.</p>
<div class="highlight-haskell"><div class="highlight"><pre><span></span><span class="nf">updateModel</span> <span class="kt">:</span> <span class="kt">Msg</span> <span class="ow">-&gt;</span> <span class="kt">Model</span> <span class="ow">-&gt;</span> <span class="p">(</span> <span class="kt">Model</span><span class="p">,</span> <span class="kt">Cmd</span> <span class="kt">Msg</span> <span class="p">)</span>
<span class="nf">updateModel</span> <span class="n">msg</span> <span class="n">model</span> <span class="ow">=</span>
    <span class="kr">case</span> <span class="n">msg</span> <span class="kr">of</span>
        <span class="kt">ToggleActive</span> <span class="ow">-&gt;</span>
            <span class="kr">if</span> <span class="n">model</span><span class="o">.</span><span class="n">active</span> <span class="kr">then</span>
                <span class="n">updateModel</span> <span class="kt">SendJson</span>
                    <span class="p">{</span> <span class="n">model</span>
                        <span class="o">|</span> <span class="n">className</span> <span class="ow">=</span> <span class="s">&quot;None&quot;</span>
                        <span class="p">,</span> <span class="n">active</span> <span class="ow">=</span> <span class="kt">False</span>
                    <span class="p">}</span>
            <span class="kr">else</span>
                <span class="n">updateModel</span> <span class="kt">SendJson</span>
                    <span class="p">{</span> <span class="n">model</span>
                        <span class="o">|</span> <span class="n">className</span> <span class="ow">=</span> <span class="n">pythonClassName</span>
                        <span class="p">,</span> <span class="n">active</span> <span class="ow">=</span> <span class="kt">True</span>
                    <span class="p">}</span>

        <span class="kt">ChangePriority</span> <span class="n">newPriority</span> <span class="ow">-&gt;</span>
            <span class="n">updateModel</span> <span class="kt">SendJson</span>
                <span class="p">{</span> <span class="n">model</span>
                    <span class="o">|</span> <span class="n">priority</span> <span class="ow">=</span> <span class="kt">Result</span><span class="o">.</span><span class="n">withDefault</span> <span class="mi">10</span> <span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="n">toInt</span> <span class="n">newPriority</span><span class="p">)</span>
                <span class="p">}</span>

        <span class="kt">SendJson</span> <span class="ow">-&gt;</span>
            <span class="p">(</span> <span class="n">model</span>
            <span class="p">,</span> <span class="n">jsonData</span>
                <span class="p">(</span><span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span><span class="o">.</span><span class="n">list</span>
                    <span class="p">[</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span><span class="o">.</span><span class="n">object</span>
                        <span class="p">[</span> <span class="p">(</span> <span class="s">&quot;module_name&quot;</span><span class="p">,</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span><span class="o">.</span><span class="n">string</span> <span class="n">pythonModuleName</span> <span class="p">)</span>
                        <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;class_name&quot;</span><span class="p">,</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span><span class="o">.</span><span class="n">string</span> <span class="n">model</span><span class="o">.</span><span class="n">className</span> <span class="p">)</span>
                        <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;priority&quot;</span><span class="p">,</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span><span class="o">.</span><span class="n">int</span> <span class="n">model</span><span class="o">.</span><span class="n">priority</span> <span class="p">)</span>
                        <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;data_register&quot;</span><span class="p">,</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span><span class="o">.</span><span class="n">list</span> <span class="p">(</span><span class="kt">List</span><span class="o">.</span><span class="n">map</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span><span class="o">.</span><span class="n">string</span> <span class="kt">[]</span><span class="p">)</span> <span class="p">)</span>
                        <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;config&quot;</span>
                          <span class="p">,</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span><span class="o">.</span><span class="n">object</span>
                                <span class="p">[</span> <span class="p">(</span> <span class="s">&quot;blanking&quot;</span><span class="p">,</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span><span class="o">.</span><span class="n">string</span> <span class="n">model</span><span class="o">.</span><span class="n">blanking</span> <span class="p">)</span>
                                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;coupling&quot;</span><span class="p">,</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span><span class="o">.</span><span class="n">string</span> <span class="n">model</span><span class="o">.</span><span class="n">coupling</span> <span class="p">)</span>
                                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;reserve&quot;</span><span class="p">,</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span><span class="o">.</span><span class="n">string</span> <span class="n">model</span><span class="o">.</span><span class="n">reserve</span> <span class="p">)</span>
                                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;filter_mode&quot;</span><span class="p">,</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span><span class="o">.</span><span class="n">string</span> <span class="n">model</span><span class="o">.</span><span class="n">mode</span> <span class="p">)</span>
                                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;gain&quot;</span><span class="p">,</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span><span class="o">.</span><span class="n">string</span> <span class="n">model</span><span class="o">.</span><span class="n">gain</span> <span class="p">)</span>
                                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;highpass_filter&quot;</span><span class="p">,</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span><span class="o">.</span><span class="n">string</span> <span class="n">model</span><span class="o">.</span><span class="n">highpass</span> <span class="p">)</span>
                                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;lowpass_filter&quot;</span><span class="p">,</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span><span class="o">.</span><span class="n">string</span> <span class="n">model</span><span class="o">.</span><span class="n">lowpass</span> <span class="p">)</span>
                                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;signal_invert_sense&quot;</span><span class="p">,</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span><span class="o">.</span><span class="n">string</span> <span class="n">model</span><span class="o">.</span><span class="n">invert</span> <span class="p">)</span>
                                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;input_source&quot;</span><span class="p">,</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span><span class="o">.</span><span class="n">string</span> <span class="n">model</span><span class="o">.</span><span class="n">source</span> <span class="p">)</span>
                                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;vernier_gain_status&quot;</span><span class="p">,</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span><span class="o">.</span><span class="n">string</span> <span class="n">model</span><span class="o">.</span><span class="n">vGainStat</span> <span class="p">)</span>
                                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;vernier_gain&quot;</span><span class="p">,</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span><span class="o">.</span><span class="n">int</span> <span class="n">model</span><span class="o">.</span><span class="n">vGain</span> <span class="p">)</span>
                                <span class="p">]</span>
                          <span class="p">)</span>
                        <span class="p">]</span>
                    <span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="kt">Close</span> <span class="ow">-&gt;</span>
            <span class="kr">let</span>
                <span class="p">(</span> <span class="n">clearInstrument</span><span class="p">,</span> <span class="n">sendJsonCmd</span> <span class="p">)</span> <span class="ow">=</span>
                    <span class="n">updateModel</span> <span class="kt">SendJson</span> <span class="o">&lt;|</span> <span class="n">defaultModel</span>
            <span class="kr">in</span>
                <span class="n">clearInstrument</span> <span class="o">!</span> <span class="p">[</span> <span class="n">sendJsonCmd</span><span class="p">,</span> <span class="n">removeModule</span> <span class="n">pythonModuleName</span> <span class="p">]</span>

        <span class="kt">ChangeBlanking</span> <span class="n">newValue</span> <span class="ow">-&gt;</span>
            <span class="n">updateModel</span> <span class="kt">SendJson</span> <span class="p">{</span> <span class="n">model</span> <span class="o">|</span> <span class="n">blanking</span> <span class="ow">=</span> <span class="n">newValue</span> <span class="p">}</span>

        <span class="kt">ChangeCoupling</span> <span class="n">newValue</span> <span class="ow">-&gt;</span>
            <span class="n">updateModel</span> <span class="kt">SendJson</span> <span class="p">{</span> <span class="n">model</span> <span class="o">|</span> <span class="n">coupling</span> <span class="ow">=</span> <span class="n">newValue</span> <span class="p">}</span>

        <span class="kt">ChangeReserve</span> <span class="n">newValue</span> <span class="ow">-&gt;</span>
            <span class="n">updateModel</span> <span class="kt">SendJson</span> <span class="p">{</span> <span class="n">model</span> <span class="o">|</span> <span class="n">reserve</span> <span class="ow">=</span> <span class="n">newValue</span> <span class="p">}</span>

        <span class="kt">ChangeFilterMode</span> <span class="n">newValue</span> <span class="ow">-&gt;</span>
            <span class="n">updateModel</span> <span class="kt">SendJson</span> <span class="p">{</span> <span class="n">model</span> <span class="o">|</span> <span class="n">mode</span> <span class="ow">=</span> <span class="n">newValue</span> <span class="p">}</span>

        <span class="kt">ChangeGain</span> <span class="n">newValue</span> <span class="ow">-&gt;</span>
            <span class="n">updateModel</span> <span class="kt">SendJson</span> <span class="p">{</span> <span class="n">model</span> <span class="o">|</span> <span class="n">gain</span> <span class="ow">=</span> <span class="n">newValue</span> <span class="p">}</span>

        <span class="kt">ChangeHighpassFilter</span> <span class="n">newValue</span> <span class="ow">-&gt;</span>
            <span class="n">updateModel</span> <span class="kt">SendJson</span> <span class="p">{</span> <span class="n">model</span> <span class="o">|</span> <span class="n">highpass</span> <span class="ow">=</span> <span class="n">newValue</span> <span class="p">}</span>

        <span class="kt">ChangeLowpassFilter</span> <span class="n">newValue</span> <span class="ow">-&gt;</span>
            <span class="n">updateModel</span> <span class="kt">SendJson</span> <span class="p">{</span> <span class="n">model</span> <span class="o">|</span> <span class="n">lowpass</span> <span class="ow">=</span> <span class="n">newValue</span> <span class="p">}</span>

        <span class="kt">ChangeSignalInvertSense</span> <span class="n">newValue</span> <span class="ow">-&gt;</span>
            <span class="n">updateModel</span> <span class="kt">SendJson</span> <span class="p">{</span> <span class="n">model</span> <span class="o">|</span> <span class="n">invert</span> <span class="ow">=</span> <span class="n">newValue</span> <span class="p">}</span>

        <span class="kt">ChangeInputSource</span> <span class="n">newValue</span> <span class="ow">-&gt;</span>
            <span class="n">updateModel</span> <span class="kt">SendJson</span> <span class="p">{</span> <span class="n">model</span> <span class="o">|</span> <span class="n">source</span> <span class="ow">=</span> <span class="n">newValue</span> <span class="p">}</span>

        <span class="kt">ChangeVernierGainStatus</span> <span class="n">newValue</span> <span class="ow">-&gt;</span>
            <span class="n">updateModel</span> <span class="kt">SendJson</span> <span class="p">{</span> <span class="n">model</span> <span class="o">|</span> <span class="n">vGainStat</span> <span class="ow">=</span> <span class="n">newValue</span> <span class="p">}</span>

        <span class="kt">ChangeVernierGain</span> <span class="n">newValue</span> <span class="ow">-&gt;</span>
            <span class="n">updateModel</span> <span class="kt">SendJson</span>
                <span class="p">{</span> <span class="n">model</span>
                    <span class="o">|</span> <span class="n">vGain</span> <span class="ow">=</span> <span class="kt">Result</span><span class="o">.</span><span class="n">withDefault</span> <span class="mi">20</span> <span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="n">toInt</span> <span class="n">newValue</span><span class="p">)</span>
                <span class="p">}</span>
</pre></div>
</div>
<p>This is big chunk of code to look at. First, observe that most of the messages
are similar. The format <code class="docutils literal"><span class="pre">updateModel</span> <span class="pre">SendJson</span> <span class="pre">{</span> <span class="pre">model</span> <span class="pre">|</span> <span class="pre">something</span> <span class="pre">=</span> <span class="pre">newValue</span>
<span class="pre">}</span></code> is used a lot. It basically means “update the model and send new JSON data
to PLACE such that <em>something</em> is now this new value”.</p>
<p>The last message, <code class="docutils literal"><span class="pre">ChangeVernierGain</span></code>, is that one we mentioned that needed
to be converted to an <code class="docutils literal"><span class="pre">Int</span></code>. This code is basically the same as the others,
but with calls to <code class="docutils literal"><span class="pre">String.toInt</span></code> and <code class="docutils literal"><span class="pre">Result.withDefault</span></code> to handle the
conversion.  You can read about these in the Elm documentation if you want to
know more about how these work.</p>
<p>The code for the first four messages, which are required by PLACE, can mostly
be copied from the template code. The code for <code class="docutils literal"><span class="pre">SendJson</span></code>, though, needs a
bit of work. We need to encode all the values from our model into JSON. Elm
handles most of the conversion for us, we just need to tell Elm what key value
to use and what the type should be.  All of our encoded values go into a JSON
dictionary under the “config” key. PLACE will send this dictionary to our
Python backend and we will be able to directly access these values using
<code class="docutils literal"><span class="pre">self._config[&lt;key_value&gt;]</span></code>.</p>
<p>Hopefully at this point you are beginning to understand how information flows
from the user to our Python module. The user makes a change to the web
interface. This change is stored in the Elm model. When the experiment starts,
the model is sent to the Python <code class="docutils literal"><span class="pre">self._config</span></code> dictionary, where it is
accessible by your backend code.</p>
</div>
<div class="section" id="creating-the-view">
<h3>Creating the view<a class="headerlink" href="#creating-the-view" title="Permalink to this headline">¶</a></h3>
<p>So far, we’ve pretty much just been writing the <em>backend of the frontend</em>. In
other words, the code we’ve written has nothing to do with what the user
actually sees in their browser. So let’s start writing the view.</p>
<p>The view seen by the user is controlled by <code class="docutils literal"><span class="pre">main</span></code>, which is an Elm “Program”.</p>
<div class="highlight-haskell"><div class="highlight"><pre><span></span><span class="nf">main</span> <span class="kt">:</span> <span class="kt">Program</span> <span class="kt">Never</span> <span class="kt">Model</span> <span class="kt">Msg</span>
<span class="nf">main</span> <span class="ow">=</span>
    <span class="kt">Html</span><span class="o">.</span><span class="n">program</span>
        <span class="p">{</span> <span class="n">init</span> <span class="ow">=</span> <span class="p">(</span> <span class="n">defaultModel</span><span class="p">,</span> <span class="kt">Cmd</span><span class="o">.</span><span class="n">none</span> <span class="p">)</span>
        <span class="p">,</span> <span class="n">view</span> <span class="ow">=</span> <span class="nf">\</span><span class="n">model</span> <span class="ow">-&gt;</span> <span class="kt">Html</span><span class="o">.</span><span class="n">div</span> <span class="kt">[]</span> <span class="p">(</span><span class="n">viewModel</span> <span class="n">model</span><span class="p">)</span>
        <span class="p">,</span> <span class="n">update</span> <span class="ow">=</span> <span class="n">updateModel</span>
        <span class="p">,</span> <span class="n">subscriptions</span> <span class="ow">=</span> <span class="nf">\</span><span class="kr">_</span> <span class="ow">-&gt;</span> <span class="kt">Sub</span><span class="o">.</span><span class="n">none</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>Don’t worry too much about the complicated type <code class="docutils literal"><span class="pre">Program</span> <span class="pre">Never</span> <span class="pre">Model</span> <span class="pre">Msg</span></code>.
Almost all PLACE modules will use this. The main thing to note here is that we
have four values (<code class="docutils literal"><span class="pre">init</span></code>, <code class="docutils literal"><span class="pre">view</span></code>, <code class="docutils literal"><span class="pre">update</span></code> and <code class="docutils literal"><span class="pre">subscriptions</span></code>) to
populate.  <code class="docutils literal"><span class="pre">init</span></code> is just the default model we already defined and the
starting command, <code class="docutils literal"><span class="pre">Cmd.none</span></code> (no command). <code class="docutils literal"><span class="pre">update</span></code> just points to the
funtion we wrote to handle all our messages. The final one, <code class="docutils literal"><span class="pre">subscriptions</span></code>,
is just set to none, since we aren’t using them.</p>
<p>We skipped <code class="docutils literal"><span class="pre">view</span></code>, and will talk about that now. This is where we see our
first HTML with the <code class="docutils literal"><span class="pre">Html.div</span></code> tag.</p>
<p>In HTML, tags are used like this (from
<a class="reference external" href="https://www.w3schools.com/tags/tag_div.asp">w3schools.com</a>):</p>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;color:#0000FF&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>This is a heading<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>This is a paragraph.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>In this example, the basic idea is that the <code class="docutils literal"><span class="pre">div</span></code> tag has some attributes and
then some more tags inside of it. Each of these tags may contain more
attributes and, again, more tags.</p>
<p>Elm changes this format by making each tag a function that takes a list of
attributes and a list of additional tags. So, the same code as above would look
something like this in Elm:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span></span><span class="kr">import</span> <span class="nn">Html</span> <span class="n">exposing</span> <span class="p">(</span><span class="n">div</span><span class="p">,</span> <span class="n">h3</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Html.Attributes</span> <span class="n">exposing</span> <span class="p">(</span><span class="n">style</span><span class="p">)</span>

<span class="nf">div</span> <span class="p">[</span> <span class="n">style</span> <span class="p">[</span><span class="s">&quot;color&quot;</span><span class="p">,</span> <span class="s">&quot;#0000FF&quot;</span><span class="p">]</span> <span class="p">]</span>
    <span class="p">[</span> <span class="n">h3</span> <span class="kt">[]</span> <span class="p">[</span> <span class="n">text</span> <span class="s">&quot;This is a heading&quot;</span> <span class="p">]</span>
    <span class="p">,</span> <span class="n">p</span> <span class="kt">[]</span> <span class="p">[</span> <span class="n">text</span> <span class="s">&quot;This is a paragraph&quot;</span> <span class="p">]</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>As you can see, the idea is roughly the same, you just have to get used to a
slightly different syntax. In my experience, Elm does not seem to be any more
or less code… just <em>different</em> code.</p>
<p>Okay. To get back on task, let’s look at the <code class="docutils literal"><span class="pre">view</span></code> in our Elm program.  We
have set <code class="docutils literal"><span class="pre">view</span> <span class="pre">=</span> <span class="pre">\model</span> <span class="pre">-&gt;</span> <span class="pre">Html.div</span> <span class="pre">[]</span> <span class="pre">(viewModel</span> <span class="pre">model)</span></code>. This is read as,
“Our view will be an HTML <code class="docutils literal"><span class="pre">div</span></code> with no attributes. All the tags in the
<code class="docutils literal"><span class="pre">div</span></code> will be provided by the <code class="docutils literal"><span class="pre">viewModel</span></code> function.” For most PLACE
modules, the entire <code class="docutils literal"><span class="pre">main</span></code> function can be copied exactly and we only need to
worry about the <code class="docutils literal"><span class="pre">viewModel</span></code> function. We will look at this function next.</p>
</div>
<div class="section" id="viewmodel">
<h3>viewModel<a class="headerlink" href="#viewmodel" title="Permalink to this headline">¶</a></h3>
<p>Writing this viewModel function is the last step of our module, but this is
where we have the most work to do. Fortunately, PLACE provides many functions
to assist in writing the HTML. It <em>is</em> possible to write your own HTML (which
is encouraged), however, this tutorial will not go into the process.</p>
<p>Here is the function:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span></span><span class="nf">viewModel</span> <span class="kt">:</span> <span class="kt">Model</span> <span class="ow">-&gt;</span> <span class="kt">List</span> <span class="p">(</span><span class="kt">Html</span> <span class="kt">Msg</span><span class="p">)</span>
<span class="nf">viewModel</span> <span class="n">model</span> <span class="ow">=</span>
    <span class="kt">ModuleHelpers</span><span class="o">.</span><span class="n">title</span> <span class="s">&quot;SRS SR560 Pre-Amp&quot;</span> <span class="n">model</span><span class="o">.</span><span class="n">active</span> <span class="kt">ToggleActive</span> <span class="kt">Close</span>
        <span class="o">++</span> <span class="kr">if</span> <span class="n">model</span><span class="o">.</span><span class="n">active</span> <span class="kr">then</span>
            <span class="p">[</span> <span class="kt">ModuleHelpers</span><span class="o">.</span><span class="n">integerField</span> <span class="s">&quot;Priority&quot;</span> <span class="n">model</span><span class="o">.</span><span class="n">priority</span> <span class="kt">ChangePriority</span>
            <span class="p">,</span> <span class="kt">ModuleHelpers</span><span class="o">.</span><span class="n">dropDownBox</span> <span class="s">&quot;Amplifier Blanking&quot;</span>
                <span class="n">model</span><span class="o">.</span><span class="n">blanking</span>
                <span class="kt">ChangeBlanking</span>
                <span class="p">[</span> <span class="p">(</span> <span class="s">&quot;not blanked&quot;</span><span class="p">,</span> <span class="s">&quot;Not blanked&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;blanked&quot;</span><span class="p">,</span> <span class="s">&quot;Blanked&quot;</span> <span class="p">)</span>
                <span class="p">]</span>
            <span class="p">,</span> <span class="kt">ModuleHelpers</span><span class="o">.</span><span class="n">dropDownBox</span> <span class="s">&quot;Input coupling&quot;</span>
                <span class="n">model</span><span class="o">.</span><span class="n">coupling</span>
                <span class="kt">ChangeCoupling</span>
                <span class="p">[</span> <span class="p">(</span> <span class="s">&quot;ground&quot;</span><span class="p">,</span> <span class="s">&quot;Ground&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;DC&quot;</span><span class="p">,</span> <span class="s">&quot;DC&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;AC&quot;</span><span class="p">,</span> <span class="s">&quot;AC&quot;</span> <span class="p">)</span>
                <span class="p">]</span>
            <span class="p">,</span> <span class="kt">ModuleHelpers</span><span class="o">.</span><span class="n">dropDownBox</span> <span class="s">&quot;Dynamic reserve&quot;</span>
                <span class="n">model</span><span class="o">.</span><span class="n">reserve</span>
                <span class="kt">ChangeReserve</span>
                <span class="p">[</span> <span class="p">(</span> <span class="s">&quot;low noise&quot;</span><span class="p">,</span> <span class="s">&quot;Low noise&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;high DR&quot;</span><span class="p">,</span> <span class="s">&quot;High dynamic reserve&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;calibration gains&quot;</span><span class="p">,</span> <span class="s">&quot;Calibration gains&quot;</span> <span class="p">)</span>
                <span class="p">]</span>
            <span class="p">,</span> <span class="kt">ModuleHelpers</span><span class="o">.</span><span class="n">dropDownBox</span> <span class="s">&quot;Filter mode&quot;</span>
                <span class="n">model</span><span class="o">.</span><span class="n">mode</span>
                <span class="kt">ChangeFilterMode</span>
                <span class="p">[</span> <span class="p">(</span> <span class="s">&quot;bypass&quot;</span><span class="p">,</span> <span class="s">&quot;Bypass&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;6 dB low pass&quot;</span><span class="p">,</span> <span class="s">&quot;6 dB low pass&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;12 dB low pass&quot;</span><span class="p">,</span> <span class="s">&quot;12 dB low pass&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;6 dB high pass&quot;</span><span class="p">,</span> <span class="s">&quot;6 dB high pass&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;12 dB high pass&quot;</span><span class="p">,</span> <span class="s">&quot;12 dB high pass&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;bandpass&quot;</span><span class="p">,</span> <span class="s">&quot;Bandpass&quot;</span> <span class="p">)</span>
                <span class="p">]</span>
            <span class="p">,</span> <span class="kt">ModuleHelpers</span><span class="o">.</span><span class="n">dropDownBox</span> <span class="s">&quot;Gain&quot;</span>
                <span class="n">model</span><span class="o">.</span><span class="n">gain</span>
                <span class="kt">ChangeGain</span>
                <span class="p">[</span> <span class="p">(</span> <span class="s">&quot;1&quot;</span><span class="p">,</span> <span class="s">&quot;1&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;2&quot;</span><span class="p">,</span> <span class="s">&quot;2&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;5&quot;</span><span class="p">,</span> <span class="s">&quot;5&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;10&quot;</span><span class="p">,</span> <span class="s">&quot;10&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;20&quot;</span><span class="p">,</span> <span class="s">&quot;20&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;50&quot;</span><span class="p">,</span> <span class="s">&quot;50&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;100&quot;</span><span class="p">,</span> <span class="s">&quot;100&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;200&quot;</span><span class="p">,</span> <span class="s">&quot;200&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;500&quot;</span><span class="p">,</span> <span class="s">&quot;500&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;1 k&quot;</span><span class="p">,</span> <span class="s">&quot;1 k&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;2 k&quot;</span><span class="p">,</span> <span class="s">&quot;2 k&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;5 k&quot;</span><span class="p">,</span> <span class="s">&quot;5 k&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;10 k&quot;</span><span class="p">,</span> <span class="s">&quot;10 k&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;20 k&quot;</span><span class="p">,</span> <span class="s">&quot;20 k&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;50 k&quot;</span><span class="p">,</span> <span class="s">&quot;50 k&quot;</span> <span class="p">)</span>
                <span class="p">]</span>
            <span class="p">,</span> <span class="kt">ModuleHelpers</span><span class="o">.</span><span class="n">dropDownBox</span> <span class="s">&quot;Highpass filter&quot;</span>
                <span class="n">model</span><span class="o">.</span><span class="n">highpass</span>
                <span class="kt">ChangeHighpassFilter</span>
                <span class="p">[</span> <span class="p">(</span> <span class="s">&quot;0.03 Hz&quot;</span><span class="p">,</span> <span class="s">&quot;0.03 Hz&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;0.1 Hz&quot;</span><span class="p">,</span> <span class="s">&quot;0.1 Hz&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;0.3 Hz&quot;</span><span class="p">,</span> <span class="s">&quot;0.3 Hz&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;1 Hz&quot;</span><span class="p">,</span> <span class="s">&quot;1 Hz&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;3 Hz&quot;</span><span class="p">,</span> <span class="s">&quot;3 Hz&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;10 Hz&quot;</span><span class="p">,</span> <span class="s">&quot;10 Hz&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;30 Hz&quot;</span><span class="p">,</span> <span class="s">&quot;30 Hz&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;100 Hz&quot;</span><span class="p">,</span> <span class="s">&quot;100 Hz&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;300 Hz&quot;</span><span class="p">,</span> <span class="s">&quot;300 Hz&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;1 kHz&quot;</span><span class="p">,</span> <span class="s">&quot;1 kHz&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;3 kHz&quot;</span><span class="p">,</span> <span class="s">&quot;3 kHz&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;10 kHz&quot;</span><span class="p">,</span> <span class="s">&quot;10 kHz&quot;</span> <span class="p">)</span>
                <span class="p">]</span>
            <span class="p">,</span> <span class="kt">ModuleHelpers</span><span class="o">.</span><span class="n">dropDownBox</span> <span class="s">&quot;Lowpass filter&quot;</span>
                <span class="n">model</span><span class="o">.</span><span class="n">lowpass</span>
                <span class="kt">ChangeLowpassFilter</span>
                <span class="p">[</span> <span class="p">(</span> <span class="s">&quot;0.03 Hz&quot;</span><span class="p">,</span> <span class="s">&quot;0.03 Hz&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;0.1 Hz&quot;</span><span class="p">,</span> <span class="s">&quot;0.1 Hz&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;0.3 Hz&quot;</span><span class="p">,</span> <span class="s">&quot;0.3 Hz&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;1 Hz&quot;</span><span class="p">,</span> <span class="s">&quot;1 Hz&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;3 Hz&quot;</span><span class="p">,</span> <span class="s">&quot;3 Hz&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;10 Hz&quot;</span><span class="p">,</span> <span class="s">&quot;10 Hz&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;30 Hz&quot;</span><span class="p">,</span> <span class="s">&quot;30 Hz&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;100 Hz&quot;</span><span class="p">,</span> <span class="s">&quot;100 Hz&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;300 Hz&quot;</span><span class="p">,</span> <span class="s">&quot;300 Hz&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;1 kHz&quot;</span><span class="p">,</span> <span class="s">&quot;1 kHz&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;3 kHz&quot;</span><span class="p">,</span> <span class="s">&quot;3 kHz&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;10 kHz&quot;</span><span class="p">,</span> <span class="s">&quot;10 kHz&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;30 kHz&quot;</span><span class="p">,</span> <span class="s">&quot;30 kHz&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;100 kHz&quot;</span><span class="p">,</span> <span class="s">&quot;100 kHz&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;300 kHz&quot;</span><span class="p">,</span> <span class="s">&quot;300 kHz&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;1 MHz&quot;</span><span class="p">,</span> <span class="s">&quot;1 MHz&quot;</span> <span class="p">)</span>
                <span class="p">]</span>
            <span class="p">,</span> <span class="kt">ModuleHelpers</span><span class="o">.</span><span class="n">dropDownBox</span> <span class="s">&quot;Signal invert sense&quot;</span>
                <span class="n">model</span><span class="o">.</span><span class="n">invert</span>
                <span class="kt">ChangeSignalInvertSense</span>
                <span class="p">[</span> <span class="p">(</span> <span class="s">&quot;non-inverted&quot;</span><span class="p">,</span> <span class="s">&quot;Non-inverted&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;inverted&quot;</span><span class="p">,</span> <span class="s">&quot;Inverted&quot;</span> <span class="p">)</span>
                <span class="p">]</span>
            <span class="p">,</span> <span class="kt">ModuleHelpers</span><span class="o">.</span><span class="n">dropDownBox</span> <span class="s">&quot;Input source&quot;</span>
                <span class="n">model</span><span class="o">.</span><span class="n">source</span>
                <span class="kt">ChangeInputSource</span>
                <span class="p">[</span> <span class="p">(</span> <span class="s">&quot;A&quot;</span><span class="p">,</span> <span class="s">&quot;Channel A&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;B&quot;</span><span class="p">,</span> <span class="s">&quot;Channel B&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;A-B&quot;</span><span class="p">,</span> <span class="s">&quot;A-B (differential)&quot;</span> <span class="p">)</span>
                <span class="p">]</span>
            <span class="p">,</span> <span class="kt">ModuleHelpers</span><span class="o">.</span><span class="n">dropDownBox</span> <span class="s">&quot;Vernier gain status&quot;</span>
                <span class="n">model</span><span class="o">.</span><span class="n">vGainStat</span>
                <span class="kt">ChangeVernierGainStatus</span>
                <span class="p">[</span> <span class="p">(</span> <span class="s">&quot;calibrated gain&quot;</span><span class="p">,</span> <span class="s">&quot;Calibrated gain&quot;</span> <span class="p">)</span>
                <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;vernier gain&quot;</span><span class="p">,</span> <span class="s">&quot;Vernier gain&quot;</span> <span class="p">)</span>
                <span class="p">]</span>
            <span class="p">,</span> <span class="kt">ModuleHelpers</span><span class="o">.</span><span class="n">integerField</span> <span class="s">&quot;Vernier gain (0-100%)&quot;</span> <span class="n">model</span><span class="o">.</span><span class="n">vGain</span> <span class="kt">ChangeVernierGain</span>
            <span class="p">,</span> <span class="kt">ModuleHelpers</span><span class="o">.</span><span class="n">rangeCheck</span> <span class="n">model</span><span class="o">.</span><span class="n">vGain</span> <span class="mi">0</span> <span class="mi">100</span> <span class="s">&quot;Error: vernier gain is invalid&quot;</span>
            <span class="p">]</span>
           <span class="kr">else</span>
            <span class="p">[</span> <span class="kt">ModuleHelpers</span><span class="o">.</span><span class="n">empty</span> <span class="p">]</span>
</pre></div>
</div>
<p>This function needs to return a list of HTML objects, which will be placed into
the <code class="docutils literal"><span class="pre">div</span></code> we talked about before. So will simply need to start listing the
things we want shown in our webapp module.</p>
<div class="section" id="title">
<h4>Title<a class="headerlink" href="#title" title="Permalink to this headline">¶</a></h4>
<p>The first item is the title. We have a function to assist in making the title
HTML.  It includes a checkbox to turn the module on and off, a text title, and
a close box to remove it from the webapp. We call it like this:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span></span><span class="p">`</span><span class="kt">ModuleHelpers</span><span class="o">.</span><span class="n">title</span> <span class="s">&quot;SRS SR560 Pre-Amp&quot;</span> <span class="n">model</span><span class="o">.</span><span class="n">active</span> <span class="kt">ToggleActive</span> <span class="kt">Close</span><span class="p">`</span>
</pre></div>
</div>
<p>It takes four arguments: (1) text for the title, (2) the location of the active
status in the model, (3) the message that toggles the active status, and (4)
the message to close the webapp. Generally, you will only need to change the
text string.</p>
</div>
<div class="section" id="active-yes-no">
<h4>Active (yes/no)<a class="headerlink" href="#active-yes-no" title="Permalink to this headline">¶</a></h4>
<p>After the title (which should always display), we have an <code class="docutils literal"><span class="pre">if</span></code> statement to
either <em>display</em> or <em>not display</em> the rest of the options. The <code class="docutils literal"><span class="pre">++</span></code> operator
concatenates the title HTML with the rest of the HTML to come.</p>
</div>
<div class="section" id="priority">
<h4>Priority<a class="headerlink" href="#priority" title="Permalink to this headline">¶</a></h4>
<p>Having a field to change the priority should usually be included in all PLACE
modules. So the first thing to display if the module is active is an integer
field allowing us to change the module <code class="docutils literal"><span class="pre">priority</span></code>.</p>
<div class="highlight-haskell"><div class="highlight"><pre><span></span><span class="kt">ModuleHelpers</span><span class="o">.</span><span class="n">integerField</span> <span class="s">&quot;Priority&quot;</span> <span class="n">model</span><span class="o">.</span><span class="n">priority</span> <span class="kt">ChangePriority</span>
</pre></div>
</div>
<p>Again, we have a helper function to create an integer field. We provide the
function with: (1) text for the field, (2) the location of the value in the
model, and (3) the message associated with changing the value.</p>
</div>
<div class="section" id="dropdown-boxes">
<h4>Dropdown boxes<a class="headerlink" href="#dropdown-boxes" title="Permalink to this headline">¶</a></h4>
<p>Dropdown boxes are easy for users, so make sense when the number of options can
be reasonably limited. Almost all of the values needed by our modules satisfy
this requirement.</p>
<p>The inputs to the dropdown menu helper function are a bit more involved than
for integer fields.</p>
<div class="highlight-haskell"><div class="highlight"><pre><span></span><span class="kt">ModuleHelpers</span><span class="o">.</span><span class="n">dropDownBox</span> <span class="s">&quot;Filter mode&quot;</span>
    <span class="n">model</span><span class="o">.</span><span class="n">mode</span>
    <span class="kt">ChangeFilterMode</span>
    <span class="p">[</span> <span class="p">(</span> <span class="s">&quot;bypass&quot;</span><span class="p">,</span> <span class="s">&quot;Bypass&quot;</span> <span class="p">)</span>
    <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;6 dB low pass&quot;</span><span class="p">,</span> <span class="s">&quot;6 dB low pass&quot;</span> <span class="p">)</span>
    <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;12 dB low pass&quot;</span><span class="p">,</span> <span class="s">&quot;12 dB low pass&quot;</span> <span class="p">)</span>
    <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;6 dB high pass&quot;</span><span class="p">,</span> <span class="s">&quot;6 dB high pass&quot;</span> <span class="p">)</span>
    <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;12 dB high pass&quot;</span><span class="p">,</span> <span class="s">&quot;12 dB high pass&quot;</span> <span class="p">)</span>
    <span class="p">,</span> <span class="p">(</span> <span class="s">&quot;bandpass&quot;</span><span class="p">,</span> <span class="s">&quot;Bandpass&quot;</span> <span class="p">)</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>This function needs: (1) the text to put next to the dropdown box, (2) the
location of the value in the model, (3) the message associated with changing
the value, and (4) string tuples for each option.</p>
<p>Why are there two strings for each option? Well, the first one is the string
used internally in the code and the second one is the text the user will see in
the dropdown menu. So, these can be the same if you like, or not. It’s up to
you. In developing other modules, I usually try to match the first value to
what is used in an instrument’s documentation, while making the second string
be a bit more descriptive.</p>
</div>
<div class="section" id="range-check">
<h4>Range check<a class="headerlink" href="#range-check" title="Permalink to this headline">¶</a></h4>
<p>The last thing to mention is the final interger field, used to get the Vernier
gain value from the user. This value is only allowed to be between 0 and 100.
Now there are complex ways to validate the data directly in the field, but this
doesn’t really provide much useful information to the user. So, what the range
check function does is to test if the value is valid and display an error
message to the user if there is a problem.</p>
<p>The <code class="docutils literal"><span class="pre">rangeCheck</span></code> function, we simply pass: (1) the location of the value in
the model, (2) the minimum valid value, (3) the maximum valid value, and (4)
the error message to display. PLACE will handle the rest.</p>
</div>
</div>
<div class="section" id="wrapping-up">
<h3>Wrapping up<a class="headerlink" href="#wrapping-up" title="Permalink to this headline">¶</a></h3>
<p>That complete the code for the Elm front end module. In a future tutorial, we
will cover how to build the JavaScript and install it into PLACE.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
    <a id="sidebar-anchor"></a>
    

  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Elm Frontend Tutorial</a><ul>
<li><a class="reference internal" href="#overview">Overview</a><ul>
<li><a class="reference internal" href="#brief-elm-introduction">Brief Elm introduction</a></li>
<li><a class="reference internal" href="#making-html-with-elm">Making HTML with Elm</a></li>
<li><a class="reference internal" href="#template-module">Template module</a></li>
</ul>
</li>
<li><a class="reference internal" href="#starting-your-own-module">Starting your own module</a><ul>
<li><a class="reference internal" href="#create-the-elm-file">Create the Elm file</a></li>
<li><a class="reference internal" href="#match-the-frontend-with-the-backend">Match the frontend with the backend</a></li>
<li><a class="reference internal" href="#module-model">Module model</a></li>
<li><a class="reference internal" href="#define-messages">Define messages</a></li>
<li><a class="reference internal" href="#ports">Ports</a></li>
<li><a class="reference internal" href="#updating-the-model">Updating the model</a></li>
<li><a class="reference internal" href="#creating-the-view">Creating the view</a></li>
<li><a class="reference internal" href="#viewmodel">viewModel</a><ul>
<li><a class="reference internal" href="#title">Title</a></li>
<li><a class="reference internal" href="#active-yes-no">Active (yes/no)</a></li>
<li><a class="reference internal" href="#priority">Priority</a></li>
<li><a class="reference internal" href="#dropdown-boxes">Dropdown boxes</a></li>
<li><a class="reference internal" href="#range-check">Range check</a></li>
</ul>
</li>
<li><a class="reference internal" href="#wrapping-up">Wrapping up</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="config.html"
                        title="previous chapter">PLACE configuration</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="backend_tutorial.html"
                        title="next chapter">Python Backend Tutorial</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="backend_tutorial.html" title="Python Backend Tutorial"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="config.html" title="PLACE configuration"
             accesskey="P">previous</a> |</li>
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Paul Freeman, Jami L. Johnson, Henrik tom Wörden, and Kasper van Wijk.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.6.
    </div>
  </body>
</html>